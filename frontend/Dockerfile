# 1ï¸âƒ£ ä½¿ç”¨ Node.js ä¾†å»ºç½®å‰ç«¯
FROM node:18 AS build

# 2ï¸âƒ£ è¨­å®šå·¥ä½œç›®éŒ„åˆ° /app
WORKDIR /app

# 3ï¸âƒ£ è¤‡è£½ package.json å’Œ package-lock.json ä¾†å¿«å–ä¾è³´
COPY package.json package-lock.json ./

# 4ï¸âƒ£ å®‰è£å‰ç«¯ä¾è³´
RUN npm install

# 5ï¸âƒ£ è¤‡è£½ frontend å…§çš„æ‰€æœ‰ç¨‹å¼ç¢¼
COPY . . 

# 6ï¸âƒ£ ä½¿ç”¨ Vite ç·¨è­¯å‰ç«¯æ‡‰ç”¨
RUN npm run build

# 7ï¸âƒ£ ä½¿ç”¨è¼•é‡ç‰ˆ Nginx ä½œç‚ºéœæ…‹æª”æ¡ˆä¼ºæœå™¨
FROM nginx:alpine

# 8ï¸âƒ£ è¤‡è£½å‰ç«¯å»ºç½®å®Œæˆçš„æª”æ¡ˆåˆ° Nginx ä¼ºæœå™¨
COPY --from=build /app/dist /usr/share/nginx/html

# 9ï¸âƒ£ æš´éœ² Nginx 80 ç«¯å£
EXPOSE 80

# ğŸ”Ÿ å•Ÿå‹• Nginx
CMD ["nginx", "-g", "daemon off;"]
